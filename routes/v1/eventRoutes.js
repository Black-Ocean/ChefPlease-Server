var connection = require('../../db/index')
var eventHelpers = require('./helpers/eventHelpers');
var url = require('url')

module.exports = function(app) {
  // route for events 
  app.route('/events')
    //get all events 
    .get(function(req, res, next) {
      var query = 'SELECT * FROM events'
      connection.query(query, function (err, results) {
        if (err) {
          res.sendStatus(404)
          console.log(err, 'ERORR')
        } 
        res.json(results);
      });
    })
    //create new event ant respond with JSON of new event
    .post(function(req, res, next) {
      var eventDetails = {
        name: req.body.name,
        time: req.body.time,
        location: req.body.location,
        text: req.body.text,
      }
      connection.query('INSERT INTO events SET ?', eventDetails, function (err, next) {
        if (err) {
          console.log(err)
          res.sendStatus(404)
        }
        // 201 status code for POST request to let user know data was placed in DB
        res.sendStatus(201);        
      })


    });

  //update event with matching id and respond w/ JSON of updated event
    app.put('/events/:id', function (req, res, next) {
      let {name, time, location, text} = req.body;
      let eventId = parseInt(req.params.id);
      connection.query('UPDATE events SET name = ?, time = ?, location = ?, text = ?  WHERE id = ?', [name, time, location, text, eventId], function(err, results) {
        if (err) {
          res.sendStatus(500).end()
        }
        res.send(results);
      })

    });

  // Delete an event given it's id. 
  app.delete('/events/:id', function (req, res, next) {
    let {name, time, location, text} = req.body;
    let eventId = parseInt(req.params.id);
    var query = `DELETE from events WHERE id = ${eventId}`
    connection.query(query, function(err) {
      if (err) {
        res.sendStatus(500).end()
      } else {

        // Send back status code: resource was successfully deleted
        res.sendStatus(202);
      }
    })















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































  });
}

  // app.get('/api/:version', function(req, res) {
  //   res.send(req.params.version);
  // });

// var post  = {id: 1, title: 'Hello MySQL'};
// var query = connection.query('INSERT INTO posts SET ?', post, function(err, result) {
//   // Neat!
// });
// console.log(query.sql); // INSERT INTO posts SET `id` = 1, `title` = 'Hello MySQL'



